(function () { var e = this, t = e._, n = {}, i = Array.prototype, r = Object.prototype, s = Function.prototype, o = i.push, a = i.slice, l = i.concat, u = r.toString, c = r.hasOwnProperty, h = i.forEach, d = i.map, f = i.reduce, p = i.reduceRight, m = i.filter, g = i.every, v = i.some, y = i.indexOf, b = i.lastIndexOf, w = Array.isArray, x = Object.keys, _ = s.bind, C = function (e) { return e instanceof C ? e : this instanceof C ? void (this._wrapped = e) : new C(e) }; "undefined" != typeof exports ? ("undefined" != typeof module && module.exports && (exports = module.exports = C), exports._ = C) : e._ = C, C.VERSION = "1.5.2"; var E = C.each = C.forEach = function (e, t, i) { if (null != e) if (h && e.forEach === h) e.forEach(t, i); else if (e.length === +e.length) { for (var r = 0, s = e.length; s > r; r++) if (t.call(i, e[r], r, e) === n) return } else for (var o = C.keys(e), r = 0, s = o.length; s > r; r++) if (t.call(i, e[o[r]], o[r], e) === n) return }; C.map = C.collect = function (e, t, n) { var i = []; return null == e ? i : d && e.map === d ? e.map(t, n) : (E(e, function (e, r, s) { i.push(t.call(n, e, r, s)) }), i) }; var T = "Reduce of empty array with no initial value"; C.reduce = C.foldl = C.inject = function (e, t, n, i) { var r = arguments.length > 2; if (null == e && (e = []), f && e.reduce === f) return i && (t = C.bind(t, i)), r ? e.reduce(t, n) : e.reduce(t); if (E(e, function (e, s, o) { r ? n = t.call(i, n, e, s, o) : (n = e, r = !0) }), !r) throw new TypeError(T); return n }, C.reduceRight = C.foldr = function (e, t, n, i) { var r = arguments.length > 2; if (null == e && (e = []), p && e.reduceRight === p) return i && (t = C.bind(t, i)), r ? e.reduceRight(t, n) : e.reduceRight(t); var s = e.length; if (s !== +s) { var o = C.keys(e); s = o.length } if (E(e, function (a, l, u) { l = o ? o[--s] : --s, r ? n = t.call(i, n, e[l], l, u) : (n = e[l], r = !0) }), !r) throw new TypeError(T); return n }, C.find = C.detect = function (e, t, n) { var i; return k(e, function (e, r, s) { return t.call(n, e, r, s) ? (i = e, !0) : void 0 }), i }, C.filter = C.select = function (e, t, n) { var i = []; return null == e ? i : m && e.filter === m ? e.filter(t, n) : (E(e, function (e, r, s) { t.call(n, e, r, s) && i.push(e) }), i) }, C.reject = function (e, t, n) { return C.filter(e, function (e, i, r) { return !t.call(n, e, i, r) }, n) }, C.every = C.all = function (e, t, i) { t || (t = C.identity); var r = !0; return null == e ? r : g && e.every === g ? e.every(t, i) : (E(e, function (e, s, o) { return (r = r && t.call(i, e, s, o)) ? void 0 : n }), !!r) }; var k = C.some = C.any = function (e, t, i) { t || (t = C.identity); var r = !1; return null == e ? r : v && e.some === v ? e.some(t, i) : (E(e, function (e, s, o) { return r || (r = t.call(i, e, s, o)) ? n : void 0 }), !!r) }; C.contains = C.include = function (e, t) { return null == e ? !1 : y && e.indexOf === y ? -1 != e.indexOf(t) : k(e, function (e) { return e === t }) }, C.invoke = function (e, t) { var n = a.call(arguments, 2), i = C.isFunction(t); return C.map(e, function (e) { return (i ? t : e[t]).apply(e, n) }) }, C.pluck = function (e, t) { return C.map(e, function (e) { return e[t] }) }, C.where = function (e, t, n) { return C.isEmpty(t) ? n ? void 0 : [] : C[n ? "find" : "filter"](e, function (e) { for (var n in t) if (t[n] !== e[n]) return !1; return !0 }) }, C.findWhere = function (e, t) { return C.where(e, t, !0) }, C.max = function (e, t, n) { if (!t && C.isArray(e) && e[0] === +e[0] && e.length < 65535) return Math.max.apply(Math, e); if (!t && C.isEmpty(e)) return -1 / 0; var i = { computed: -1 / 0, value: -1 / 0 }; return E(e, function (e, r, s) { var o = t ? t.call(n, e, r, s) : e; o > i.computed && (i = { value: e, computed: o }) }), i.value }, C.min = function (e, t, n) { if (!t && C.isArray(e) && e[0] === +e[0] && e.length < 65535) return Math.min.apply(Math, e); if (!t && C.isEmpty(e)) return 1 / 0; var i = { computed: 1 / 0, value: 1 / 0 }; return E(e, function (e, r, s) { var o = t ? t.call(n, e, r, s) : e; o < i.computed && (i = { value: e, computed: o }) }), i.value }, C.shuffle = function (e) { var t, n = 0, i = []; return E(e, function (e) { t = C.random(n++), i[n - 1] = i[t], i[t] = e }), i }, C.sample = function (e, t, n) { return arguments.length < 2 || n ? e[C.random(e.length - 1)] : C.shuffle(e).slice(0, Math.max(0, t)) }; var R = function (e) { return C.isFunction(e) ? e : function (t) { return t[e] } }; C.sortBy = function (e, t, n) { var i = R(t); return C.pluck(C.map(e, function (e, t, r) { return { value: e, index: t, criteria: i.call(n, e, t, r) } }).sort(function (e, t) { var n = e.criteria, i = t.criteria; if (n !== i) { if (n > i || void 0 === n) return 1; if (i > n || void 0 === i) return -1 } return e.index - t.index }), "value") }; var $ = function (e) { return function (t, n, i) { var r = {}, s = null == n ? C.identity : R(n); return E(t, function (n, o) { var a = s.call(i, n, o, t); e(r, a, n) }), r } }; C.groupBy = $(function (e, t, n) { (C.has(e, t) ? e[t] : e[t] = []).push(n) }), C.indexBy = $(function (e, t, n) { e[t] = n }), C.countBy = $(function (e, t) { C.has(e, t) ? e[t]++ : e[t] = 1 }), C.sortedIndex = function (e, t, n, i) { n = null == n ? C.identity : R(n); for (var r = n.call(i, t), s = 0, o = e.length; o > s;) { var a = s + o >>> 1; n.call(i, e[a]) < r ? s = a + 1 : o = a } return s }, C.toArray = function (e) { return e ? C.isArray(e) ? a.call(e) : e.length === +e.length ? C.map(e, C.identity) : C.values(e) : [] }, C.size = function (e) { return null == e ? 0 : e.length === +e.length ? e.length : C.keys(e).length }, C.first = C.head = C.take = function (e, t, n) { return null == e ? void 0 : null == t || n ? e[0] : a.call(e, 0, t) }, C.initial = function (e, t, n) { return a.call(e, 0, e.length - (null == t || n ? 1 : t)) }, C.last = function (e, t, n) { return null == e ? void 0 : null == t || n ? e[e.length - 1] : a.call(e, Math.max(e.length - t, 0)) }, C.rest = C.tail = C.drop = function (e, t, n) { return a.call(e, null == t || n ? 1 : t) }, C.compact = function (e) { return C.filter(e, C.identity) }; var N = function (e, t, n) { return t && C.every(e, C.isArray) ? l.apply(n, e) : (E(e, function (e) { C.isArray(e) || C.isArguments(e) ? t ? o.apply(n, e) : N(e, t, n) : n.push(e) }), n) }; C.flatten = function (e, t) { return N(e, t, []) }, C.without = function (e) { return C.difference(e, a.call(arguments, 1)) }, C.uniq = C.unique = function (e, t, n, i) { C.isFunction(t) && (i = n, n = t, t = !1); var r = n ? C.map(e, n, i) : e, s = [], o = []; return E(r, function (n, i) { (t ? i && o[o.length - 1] === n : C.contains(o, n)) || (o.push(n), s.push(e[i])) }), s }, C.union = function () { return C.uniq(C.flatten(arguments, !0)) }, C.intersection = function (e) { var t = a.call(arguments, 1); return C.filter(C.uniq(e), function (e) { return C.every(t, function (t) { return C.indexOf(t, e) >= 0 }) }) }, C.difference = function (e) { var t = l.apply(i, a.call(arguments, 1)); return C.filter(e, function (e) { return !C.contains(t, e) }) }, C.zip = function () { for (var e = C.max(C.pluck(arguments, "length").concat(0)), t = new Array(e), n = 0; e > n; n++) t[n] = C.pluck(arguments, "" + n); return t }, C.object = function (e, t) { if (null == e) return {}; for (var n = {}, i = 0, r = e.length; r > i; i++) t ? n[e[i]] = t[i] : n[e[i][0]] = e[i][1]; return n }, C.indexOf = function (e, t, n) { if (null == e) return -1; var i = 0, r = e.length; if (n) { if ("number" != typeof n) return i = C.sortedIndex(e, t), e[i] === t ? i : -1; i = 0 > n ? Math.max(0, r + n) : n } if (y && e.indexOf === y) return e.indexOf(t, n); for (; r > i; i++) if (e[i] === t) return i; return -1 }, C.lastIndexOf = function (e, t, n) { if (null == e) return -1; var i = null != n; if (b && e.lastIndexOf === b) return i ? e.lastIndexOf(t, n) : e.lastIndexOf(t); for (var r = i ? n : e.length; r--;) if (e[r] === t) return r; return -1 }, C.range = function (e, t, n) { arguments.length <= 1 && (t = e || 0, e = 0), n = arguments[2] || 1; for (var i = Math.max(Math.ceil((t - e) / n), 0), r = 0, s = new Array(i) ; i > r;) s[r++] = e, e += n; return s }; var S = function () { }; C.bind = function (e, t) { var n, i; if (_ && e.bind === _) return _.apply(e, a.call(arguments, 1)); if (!C.isFunction(e)) throw new TypeError; return n = a.call(arguments, 2), i = function () { if (!(this instanceof i)) return e.apply(t, n.concat(a.call(arguments))); S.prototype = e.prototype; var r = new S; S.prototype = null; var s = e.apply(r, n.concat(a.call(arguments))); return Object(s) === s ? s : r } }, C.partial = function (e) { var t = a.call(arguments, 1); return function () { return e.apply(this, t.concat(a.call(arguments))) } }, C.bindAll = function (e) { var t = a.call(arguments, 1); if (0 === t.length) throw new Error("bindAll must be passed function names"); return E(t, function (t) { e[t] = C.bind(e[t], e) }), e }, C.memoize = function (e, t) { var n = {}; return t || (t = C.identity), function () { var i = t.apply(this, arguments); return C.has(n, i) ? n[i] : n[i] = e.apply(this, arguments) } }, C.delay = function (e, t) { var n = a.call(arguments, 2); return setTimeout(function () { return e.apply(null, n) }, t) }, C.defer = function (e) { return C.delay.apply(C, [e, 1].concat(a.call(arguments, 1))) }, C.throttle = function (e, t, n) { var i, r, s, o = null, a = 0; n || (n = {}); var l = function () { a = n.leading === !1 ? 0 : new Date, o = null, s = e.apply(i, r) }; return function () { var u = new Date; a || n.leading !== !1 || (a = u); var c = t - (u - a); return i = this, r = arguments, 0 >= c ? (clearTimeout(o), o = null, a = u, s = e.apply(i, r)) : o || n.trailing === !1 || (o = setTimeout(l, c)), s } }, C.debounce = function (e, t, n) { var i, r, s, o, a; return function () { s = this, r = arguments, o = new Date; var l = function () { var u = new Date - o; t > u ? i = setTimeout(l, t - u) : (i = null, n || (a = e.apply(s, r))) }, u = n && !i; return i || (i = setTimeout(l, t)), u && (a = e.apply(s, r)), a } }, C.once = function (e) { var t, n = !1; return function () { return n ? t : (n = !0, t = e.apply(this, arguments), e = null, t) } }, C.wrap = function (e, t) { return function () { var n = [e]; return o.apply(n, arguments), t.apply(this, n) } }, C.compose = function () { var e = arguments; return function () { for (var t = arguments, n = e.length - 1; n >= 0; n--) t = [e[n].apply(this, t)]; return t[0] } }, C.after = function (e, t) { return function () { return --e < 1 ? t.apply(this, arguments) : void 0 } }, C.keys = x || function (e) { if (e !== Object(e)) throw new TypeError("Invalid object"); var t = []; for (var n in e) C.has(e, n) && t.push(n); return t }, C.values = function (e) { for (var t = C.keys(e), n = t.length, i = new Array(n), r = 0; n > r; r++) i[r] = e[t[r]]; return i }, C.pairs = function (e) { for (var t = C.keys(e), n = t.length, i = new Array(n), r = 0; n > r; r++) i[r] = [t[r], e[t[r]]]; return i }, C.invert = function (e) { for (var t = {}, n = C.keys(e), i = 0, r = n.length; r > i; i++) t[e[n[i]]] = n[i]; return t }, C.functions = C.methods = function (e) { var t = []; for (var n in e) C.isFunction(e[n]) && t.push(n); return t.sort() }, C.extend = function (e) { return E(a.call(arguments, 1), function (t) { if (t) for (var n in t) e[n] = t[n] }), e }, C.pick = function (e) { var t = {}, n = l.apply(i, a.call(arguments, 1)); return E(n, function (n) { n in e && (t[n] = e[n]) }), t }, C.omit = function (e) { var t = {}, n = l.apply(i, a.call(arguments, 1)); for (var r in e) C.contains(n, r) || (t[r] = e[r]); return t }, C.defaults = function (e) { return E(a.call(arguments, 1), function (t) { if (t) for (var n in t) void 0 === e[n] && (e[n] = t[n]) }), e }, C.clone = function (e) { return C.isObject(e) ? C.isArray(e) ? e.slice() : C.extend({}, e) : e }, C.tap = function (e, t) { return t(e), e }; var O = function (e, t, n, i) { if (e === t) return 0 !== e || 1 / e == 1 / t; if (null == e || null == t) return e === t; e instanceof C && (e = e._wrapped), t instanceof C && (t = t._wrapped); var r = u.call(e); if (r != u.call(t)) return !1; switch (r) { case "[object String]": return e == String(t); case "[object Number]": return e != +e ? t != +t : 0 == e ? 1 / e == 1 / t : e == +t; case "[object Date]": case "[object Boolean]": return +e == +t; case "[object RegExp]": return e.source == t.source && e.global == t.global && e.multiline == t.multiline && e.ignoreCase == t.ignoreCase } if ("object" != typeof e || "object" != typeof t) return !1; for (var s = n.length; s--;) if (n[s] == e) return i[s] == t; var o = e.constructor, a = t.constructor; if (o !== a && !(C.isFunction(o) && o instanceof o && C.isFunction(a) && a instanceof a)) return !1; n.push(e), i.push(t); var l = 0, c = !0; if ("[object Array]" == r) { if (l = e.length, c = l == t.length) for (; l-- && (c = O(e[l], t[l], n, i)) ;); } else { for (var h in e) if (C.has(e, h) && (l++, !(c = C.has(t, h) && O(e[h], t[h], n, i)))) break; if (c) { for (h in t) if (C.has(t, h) && !l--) break; c = !l } } return n.pop(), i.pop(), c }; C.isEqual = function (e, t) { return O(e, t, [], []) }, C.isEmpty = function (e) { if (null == e) return !0; if (C.isArray(e) || C.isString(e)) return 0 === e.length; for (var t in e) if (C.has(e, t)) return !1; return !0 }, C.isElement = function (e) { return !(!e || 1 !== e.nodeType) }, C.isArray = w || function (e) { return "[object Array]" == u.call(e) }, C.isObject = function (e) { return e === Object(e) }, E(["Arguments", "Function", "String", "Number", "Date", "RegExp"], function (e) { C["is" + e] = function (t) { return u.call(t) == "[object " + e + "]" } }), C.isArguments(arguments) || (C.isArguments = function (e) { return !(!e || !C.has(e, "callee")) }), "function" != typeof /./ && (C.isFunction = function (e) { return "function" == typeof e }), C.isFinite = function (e) { return isFinite(e) && !isNaN(parseFloat(e)) }, C.isNaN = function (e) { return C.isNumber(e) && e != +e }, C.isBoolean = function (e) { return e === !0 || e === !1 || "[object Boolean]" == u.call(e) }, C.isNull = function (e) { return null === e }, C.isUndefined = function (e) { return void 0 === e }, C.has = function (e, t) { return c.call(e, t) }, C.noConflict = function () { return e._ = t, this }, C.identity = function (e) { return e }, C.times = function (e, t, n) { for (var i = Array(Math.max(0, e)), r = 0; e > r; r++) i[r] = t.call(n, r); return i }, C.random = function (e, t) { return null == t && (t = e, e = 0), e + Math.floor(Math.random() * (t - e + 1)) }; var A = { escape: { "&": "&amp;", "<": "&lt;", ">": "&gt;", '"': "&quot;", "'": "&#x27;" } }; A.unescape = C.invert(A.escape); var M = { escape: new RegExp("[" + C.keys(A.escape).join("") + "]", "g"), unescape: new RegExp("(" + C.keys(A.unescape).join("|") + ")", "g") }; C.each(["escape", "unescape"], function (e) { C[e] = function (t) { return null == t ? "" : ("" + t).replace(M[e], function (t) { return A[e][t] }) } }), C.result = function (e, t) { if (null == e) return void 0; var n = e[t]; return C.isFunction(n) ? n.call(e) : n }, C.mixin = function (e) { E(C.functions(e), function (t) { var n = C[t] = e[t]; C.prototype[t] = function () { var e = [this._wrapped]; return o.apply(e, arguments), B.call(this, n.apply(C, e)) } }) }; var D = 0; C.uniqueId = function (e) { var t = ++D + ""; return e ? e + t : t }, C.templateSettings = { evaluate: /<%([\s\S]+?)%>/g, interpolate: /<%=([\s\S]+?)%>/g, escape: /<%-([\s\S]+?)%>/g }; var I = /(.)^/, j = { "'": "'", "\\": "\\", "\r": "r", "\n": "n", "	": "t", "\u2028": "u2028", "\u2029": "u2029" }, F = /\\|'|\r|\n|\t|\u2028|\u2029/g; C.template = function (e, t, n) { var i; n = C.defaults({}, n, C.templateSettings); var r = new RegExp([(n.escape || I).source, (n.interpolate || I).source, (n.evaluate || I).source].join("|") + "|$", "g"), s = 0, o = "__p+='"; e.replace(r, function (t, n, i, r, a) { return o += e.slice(s, a).replace(F, function (e) { return "\\" + j[e] }), n && (o += "'+\n((__t=(" + n + "))==null?'':_.escape(__t))+\n'"), i && (o += "'+\n((__t=(" + i + "))==null?'':__t)+\n'"), r && (o += "';\n" + r + "\n__p+='"), s = a + t.length, t }), o += "';\n", n.variable || (o = "with(obj||{}){\n" + o + "}\n"), o = "var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n" + o + "return __p;\n"; try { i = new Function(n.variable || "obj", "_", o) } catch (a) { throw a.source = o, a } if (t) return i(t, C); var l = function (e) { return i.call(this, e, C) }; return l.source = "function(" + (n.variable || "obj") + "){\n" + o + "}", l }, C.chain = function (e) { return C(e).chain() }; var B = function (e) { return this._chain ? C(e).chain() : e }; C.mixin(C), E(["pop", "push", "reverse", "shift", "sort", "splice", "unshift"], function (e) { var t = i[e]; C.prototype[e] = function () { var n = this._wrapped; return t.apply(n, arguments), "shift" != e && "splice" != e || 0 !== n.length || delete n[0], B.call(this, n) } }), E(["concat", "join", "slice"], function (e) { var t = i[e]; C.prototype[e] = function () { return B.call(this, t.apply(this._wrapped, arguments)) } }), C.extend(C.prototype, { chain: function () { return this._chain = !0, this }, value: function () { return this._wrapped } }) }).call(this), function () {
    { var e, t = this, n = t.Backbone, i = [], r = (i.push, i.slice); i.splice } e = "undefined" != typeof exports ? exports : t.Backbone = {}, e.VERSION = "1.1.0"; var s = t._; s || "undefined" == typeof require || (s = require("underscore")), e.$ = t.jQuery || t.Zepto || t.ender || t.$, e.noConflict = function () { return t.Backbone = n, this }, e.emulateHTTP = !1, e.emulateJSON = !1; var o = e.Events = { on: function (e, t, n) { if (!l(this, "on", e, [t, n]) || !t) return this; this._events || (this._events = {}); var i = this._events[e] || (this._events[e] = []); return i.push({ callback: t, context: n, ctx: n || this }), this }, once: function (e, t, n) { if (!l(this, "once", e, [t, n]) || !t) return this; var i = this, r = s.once(function () { i.off(e, r), t.apply(this, arguments) }); return r._callback = t, this.on(e, r, n) }, off: function (e, t, n) { var i, r, o, a, u, c, h, d; if (!this._events || !l(this, "off", e, [t, n])) return this; if (!e && !t && !n) return this._events = {}, this; for (a = e ? [e] : s.keys(this._events), u = 0, c = a.length; c > u; u++) if (e = a[u], o = this._events[e]) { if (this._events[e] = i = [], t || n) for (h = 0, d = o.length; d > h; h++) r = o[h], (t && t !== r.callback && t !== r.callback._callback || n && n !== r.context) && i.push(r); i.length || delete this._events[e] } return this }, trigger: function (e) { if (!this._events) return this; var t = r.call(arguments, 1); if (!l(this, "trigger", e, t)) return this; var n = this._events[e], i = this._events.all; return n && u(n, t), i && u(i, arguments), this }, stopListening: function (e, t, n) { var i = this._listeningTo; if (!i) return this; var r = !t && !n; n || "object" != typeof t || (n = this), e && ((i = {})[e._listenId] = e); for (var o in i) e = i[o], e.off(t, n, this), (r || s.isEmpty(e._events)) && delete this._listeningTo[o]; return this } }, a = /\s+/, l = function (e, t, n, i) { if (!n) return !0; if ("object" == typeof n) { for (var r in n) e[t].apply(e, [r, n[r]].concat(i)); return !1 } if (a.test(n)) { for (var s = n.split(a), o = 0, l = s.length; l > o; o++) e[t].apply(e, [s[o]].concat(i)); return !1 } return !0 }, u = function (e, t) { var n, i = -1, r = e.length, s = t[0], o = t[1], a = t[2]; switch (t.length) { case 0: for (; ++i < r;) (n = e[i]).callback.call(n.ctx); return; case 1: for (; ++i < r;) (n = e[i]).callback.call(n.ctx, s); return; case 2: for (; ++i < r;) (n = e[i]).callback.call(n.ctx, s, o); return; case 3: for (; ++i < r;) (n = e[i]).callback.call(n.ctx, s, o, a); return; default: for (; ++i < r;) (n = e[i]).callback.apply(n.ctx, t) } }, c = { listenTo: "on", listenToOnce: "once" }; s.each(c, function (e, t) { o[t] = function (t, n, i) { var r = this._listeningTo || (this._listeningTo = {}), o = t._listenId || (t._listenId = s.uniqueId("l")); return r[o] = t, i || "object" != typeof n || (i = this), t[e](n, i, this), this } }), o.bind = o.on, o.unbind = o.off, s.extend(e, o); var h = e.Model = function (e, t) { var n = e || {}; t || (t = {}), this.cid = s.uniqueId("c"), this.attributes = {}, t.collection && (this.collection = t.collection), t.parse && (n = this.parse(n, t) || {}), n = s.defaults({}, n, s.result(this, "defaults")), this.set(n, t), this.changed = {}, this.initialize.apply(this, arguments) }; s.extend(h.prototype, o, { changed: null, validationError: null, idAttribute: "id", initialize: function () { }, toJSON: function () { return s.clone(this.attributes) }, sync: function () { return e.sync.apply(this, arguments) }, get: function (e) { return this.attributes[e] }, escape: function (e) { return s.escape(this.get(e)) }, has: function (e) { return null != this.get(e) }, set: function (e, t, n) { var i, r, o, a, l, u, c, h; if (null == e) return this; if ("object" == typeof e ? (r = e, n = t) : (r = {})[e] = t, n || (n = {}), !this._validate(r, n)) return !1; o = n.unset, l = n.silent, a = [], u = this._changing, this._changing = !0, u || (this._previousAttributes = s.clone(this.attributes), this.changed = {}), h = this.attributes, c = this._previousAttributes, this.idAttribute in r && (this.id = r[this.idAttribute]); for (i in r) t = r[i], s.isEqual(h[i], t) || a.push(i), s.isEqual(c[i], t) ? delete this.changed[i] : this.changed[i] = t, o ? delete h[i] : h[i] = t; if (!l) { a.length && (this._pending = !0); for (var d = 0, f = a.length; f > d; d++) this.trigger("change:" + a[d], this, h[a[d]], n) } if (u) return this; if (!l) for (; this._pending;) this._pending = !1, this.trigger("change", this, n); return this._pending = !1, this._changing = !1, this }, unset: function (e, t) { return this.set(e, void 0, s.extend({}, t, { unset: !0 })) }, clear: function (e) { var t = {}; for (var n in this.attributes) t[n] = void 0; return this.set(t, s.extend({}, e, { unset: !0 })) }, hasChanged: function (e) { return null == e ? !s.isEmpty(this.changed) : s.has(this.changed, e) }, changedAttributes: function (e) { if (!e) return this.hasChanged() ? s.clone(this.changed) : !1; var t, n = !1, i = this._changing ? this._previousAttributes : this.attributes; for (var r in e) s.isEqual(i[r], t = e[r]) || ((n || (n = {}))[r] = t); return n }, previous: function (e) { return null != e && this._previousAttributes ? this._previousAttributes[e] : null }, previousAttributes: function () { return s.clone(this._previousAttributes) }, fetch: function (e) { e = e ? s.clone(e) : {}, void 0 === e.parse && (e.parse = !0); var t = this, n = e.success; return e.success = function (i) { return t.set(t.parse(i, e), e) ? (n && n(t, i, e), void t.trigger("sync", t, i, e)) : !1 }, j(this, e), this.sync("read", this, e) }, save: function (e, t, n) { var i, r, o, a = this.attributes; if (null == e || "object" == typeof e ? (i = e, n = t) : (i = {})[e] = t, n = s.extend({ validate: !0 }, n), i && !n.wait) { if (!this.set(i, n)) return !1 } else if (!this._validate(i, n)) return !1; i && n.wait && (this.attributes = s.extend({}, a, i)), void 0 === n.parse && (n.parse = !0); var l = this, u = n.success; return n.success = function (e) { l.attributes = a; var t = l.parse(e, n); return n.wait && (t = s.extend(i || {}, t)), s.isObject(t) && !l.set(t, n) ? !1 : (u && u(l, e, n), void l.trigger("sync", l, e, n)) }, j(this, n), r = this.isNew() ? "create" : n.patch ? "patch" : "update", "patch" === r && (n.attrs = i), o = this.sync(r, this, n), i && n.wait && (this.attributes = a), o }, destroy: function (e) { e = e ? s.clone(e) : {}; var t = this, n = e.success, i = function () { t.trigger("destroy", t, t.collection, e) }; if (e.success = function (r) { (e.wait || t.isNew()) && i(), n && n(t, r, e), t.isNew() || t.trigger("sync", t, r, e) }, this.isNew()) return e.success(), !1; j(this, e); var r = this.sync("delete", this, e); return e.wait || i(), r }, url: function () { var e = s.result(this, "urlRoot") || s.result(this.collection, "url") || I(); return this.isNew() ? e : e + ("/" === e.charAt(e.length - 1) ? "" : "/") + encodeURIComponent(this.id) }, parse: function (e) { return e }, clone: function () { return new this.constructor(this.attributes) }, isNew: function () { return null == this.id }, isValid: function (e) { return this._validate({}, s.extend(e || {}, { validate: !0 })) }, _validate: function (e, t) { if (!t.validate || !this.validate) return !0; e = s.extend({}, this.attributes, e); var n = this.validationError = this.validate(e, t) || null; return n ? (this.trigger("invalid", this, n, s.extend(t, { validationError: n })), !1) : !0 } }); var d = ["keys", "values", "pairs", "invert", "pick", "omit"]; s.each(d, function (e) { h.prototype[e] = function () { var t = r.call(arguments); return t.unshift(this.attributes), s[e].apply(s, t) } }); var f = e.Collection = function (e, t) { t || (t = {}), t.model && (this.model = t.model), void 0 !== t.comparator && (this.comparator = t.comparator), this._reset(), this.initialize.apply(this, arguments), e && this.reset(e, s.extend({ silent: !0 }, t)) }, p = { add: !0, remove: !0, merge: !0 }, m = { add: !0, remove: !1 }; s.extend(f.prototype, o, { model: h, initialize: function () { }, toJSON: function (e) { return this.map(function (t) { return t.toJSON(e) }) }, sync: function () { return e.sync.apply(this, arguments) }, add: function (e, t) { return this.set(e, s.extend({ merge: !1 }, t, m)) }, remove: function (e, t) { var n = !s.isArray(e); e = n ? [e] : s.clone(e), t || (t = {}); var i, r, o, a; for (i = 0, r = e.length; r > i; i++) a = e[i] = this.get(e[i]), a && (delete this._byId[a.id], delete this._byId[a.cid], o = this.indexOf(a), this.models.splice(o, 1), this.length--, t.silent || (t.index = o, a.trigger("remove", a, this, t)), this._removeReference(a)); return n ? e[0] : e }, set: function (e, t) { t = s.defaults({}, t, p), t.parse && (e = this.parse(e, t)); var n = !s.isArray(e); e = n ? e ? [e] : [] : s.clone(e); var i, r, o, a, l, u, c, d = t.at, f = this.model, m = this.comparator && null == d && t.sort !== !1, g = s.isString(this.comparator) ? this.comparator : null, v = [], y = [], b = {}, w = t.add, x = t.merge, _ = t.remove, C = !m && w && _ ? [] : !1; for (i = 0, r = e.length; r > i; i++) { if (l = e[i], o = l instanceof h ? a = l : l[f.prototype.idAttribute], u = this.get(o)) _ && (b[u.cid] = !0), x && (l = l === a ? a.attributes : l, t.parse && (l = u.parse(l, t)), u.set(l, t), m && !c && u.hasChanged(g) && (c = !0)), e[i] = u; else if (w) { if (a = e[i] = this._prepareModel(l, t), !a) continue; v.push(a), a.on("all", this._onModelEvent, this), this._byId[a.cid] = a, null != a.id && (this._byId[a.id] = a) } C && C.push(u || a) } if (_) { for (i = 0, r = this.length; r > i; ++i) b[(a = this.models[i]).cid] || y.push(a); y.length && this.remove(y, t) } if (v.length || C && C.length) if (m && (c = !0), this.length += v.length, null != d) for (i = 0, r = v.length; r > i; i++) this.models.splice(d + i, 0, v[i]); else { C && (this.models.length = 0); var E = C || v; for (i = 0, r = E.length; r > i; i++) this.models.push(E[i]) } if (c && this.sort({ silent: !0 }), !t.silent) { for (i = 0, r = v.length; r > i; i++) (a = v[i]).trigger("add", a, this, t); (c || C && C.length) && this.trigger("sort", this, t) } return n ? e[0] : e }, reset: function (e, t) { t || (t = {}); for (var n = 0, i = this.models.length; i > n; n++) this._removeReference(this.models[n]); return t.previousModels = this.models, this._reset(), e = this.add(e, s.extend({ silent: !0 }, t)), t.silent || this.trigger("reset", this, t), e }, push: function (e, t) { return this.add(e, s.extend({ at: this.length }, t)) }, pop: function (e) { var t = this.at(this.length - 1); return this.remove(t, e), t }, unshift: function (e, t) { return this.add(e, s.extend({ at: 0 }, t)) }, shift: function (e) { var t = this.at(0); return this.remove(t, e), t }, slice: function () { return r.apply(this.models, arguments) }, get: function (e) { return null == e ? void 0 : this._byId[e.id] || this._byId[e.cid] || this._byId[e] }, at: function (e) { return this.models[e] }, where: function (e, t) { return s.isEmpty(e) ? t ? void 0 : [] : this[t ? "find" : "filter"](function (t) { for (var n in e) if (e[n] !== t.get(n)) return !1; return !0 }) }, findWhere: function (e) { return this.where(e, !0) }, sort: function (e) { if (!this.comparator) throw new Error("Cannot sort a set without a comparator"); return e || (e = {}), s.isString(this.comparator) || 1 === this.comparator.length ? this.models = this.sortBy(this.comparator, this) : this.models.sort(s.bind(this.comparator, this)), e.silent || this.trigger("sort", this, e), this }, pluck: function (e) { return s.invoke(this.models, "get", e) }, fetch: function (e) { e = e ? s.clone(e) : {}, void 0 === e.parse && (e.parse = !0); var t = e.success, n = this; return e.success = function (i) { var r = e.reset ? "reset" : "set"; n[r](i, e), t && t(n, i, e), n.trigger("sync", n, i, e) }, j(this, e), this.sync("read", this, e) }, create: function (e, t) { if (t = t ? s.clone(t) : {}, !(e = this._prepareModel(e, t))) return !1; t.wait || this.add(e, t); var n = this, i = t.success; return t.success = function (e, t, r) { r.wait && n.add(e, r), i && i(e, t, r) }, e.save(null, t), e }, parse: function (e) { return e }, clone: function () { return new this.constructor(this.models) }, _reset: function () { this.length = 0, this.models = [], this._byId = {} }, _prepareModel: function (e, t) { if (e instanceof h) return e.collection || (e.collection = this), e; t = t ? s.clone(t) : {}, t.collection = this; var n = new this.model(e, t); return n.validationError ? (this.trigger("invalid", this, n.validationError, t), !1) : n }, _removeReference: function (e) { this === e.collection && delete e.collection, e.off("all", this._onModelEvent, this) }, _onModelEvent: function (e, t, n, i) { ("add" !== e && "remove" !== e || n === this) && ("destroy" === e && this.remove(t, i), t && e === "change:" + t.idAttribute && (delete this._byId[t.previous(t.idAttribute)], null != t.id && (this._byId[t.id] = t)), this.trigger.apply(this, arguments)) } }); var g = ["forEach", "each", "map", "collect", "reduce", "foldl", "inject", "reduceRight", "foldr", "find", "detect", "filter", "select", "reject", "every", "all", "some", "any", "include", "contains", "invoke", "max", "min", "toArray", "size", "first", "head", "take", "initial", "rest", "tail", "drop", "last", "without", "difference", "indexOf", "shuffle", "lastIndexOf", "isEmpty", "chain"]; s.each(g, function (e) { f.prototype[e] = function () { var t = r.call(arguments); return t.unshift(this.models), s[e].apply(s, t) } }); var v = ["groupBy", "countBy", "sortBy"]; s.each(v, function (e) { f.prototype[e] = function (t, n) { var i = s.isFunction(t) ? t : function (e) { return e.get(t) }; return s[e](this.models, i, n) } }); var y = e.View = function (e) { this.cid = s.uniqueId("view"), e || (e = {}), s.extend(this, s.pick(e, w)), this._ensureElement(), this.initialize.apply(this, arguments), this.delegateEvents() }, b = /^(\S+)\s*(.*)$/, w = ["model", "collection", "el", "id", "attributes", "className", "tagName", "events"]; s.extend(y.prototype, o, { tagName: "div", $: function (e) { return this.$el.find(e) }, initialize: function () { }, render: function () { return this }, remove: function () { return this.$el.remove(), this.stopListening(), this }, setElement: function (t, n) { return this.$el && this.undelegateEvents(), this.$el = t instanceof e.$ ? t : e.$(t), this.el = this.$el[0], n !== !1 && this.delegateEvents(), this }, delegateEvents: function (e) { if (!e && !(e = s.result(this, "events"))) return this; this.undelegateEvents(); for (var t in e) { var n = e[t]; if (s.isFunction(n) || (n = this[e[t]]), n) { var i = t.match(b), r = i[1], o = i[2]; n = s.bind(n, this), r += ".delegateEvents" + this.cid, "" === o ? this.$el.on(r, n) : this.$el.on(r, o, n) } } return this }, undelegateEvents: function () { return this.$el.off(".delegateEvents" + this.cid), this }, _ensureElement: function () { if (this.el) this.setElement(s.result(this, "el"), !1); else { var t = s.extend({}, s.result(this, "attributes")); this.id && (t.id = s.result(this, "id")), this.className && (t["class"] = s.result(this, "className")); var n = e.$("<" + s.result(this, "tagName") + ">").attr(t); this.setElement(n, !1) } } }), e.sync = function (t, n, i) { var r = _[t]; s.defaults(i || (i = {}), { emulateHTTP: e.emulateHTTP, emulateJSON: e.emulateJSON }); var o = { type: r, dataType: "json" }; if (i.url || (o.url = s.result(n, "url") || I()), null != i.data || !n || "create" !== t && "update" !== t && "patch" !== t || (o.contentType = "application/json", o.data = JSON.stringify(i.attrs || n.toJSON(i))), i.emulateJSON && (o.contentType = "application/x-www-form-urlencoded", o.data = o.data ? { model: o.data } : {}), i.emulateHTTP && ("PUT" === r || "DELETE" === r || "PATCH" === r)) { o.type = "POST", i.emulateJSON && (o.data._method = r); var a = i.beforeSend; i.beforeSend = function (e) { return e.setRequestHeader("X-HTTP-Method-Override", r), a ? a.apply(this, arguments) : void 0 } } "GET" === o.type || i.emulateJSON || (o.processData = !1), "PATCH" === o.type && x && (o.xhr = function () { return new ActiveXObject("Microsoft.XMLHTTP") }); var l = i.xhr = e.ajax(s.extend(o, i)); return n.trigger("request", n, l, i), l }; var x = !("undefined" == typeof window || !window.ActiveXObject || window.XMLHttpRequest && (new XMLHttpRequest).dispatchEvent), _ = { create: "POST", update: "PUT", patch: "PATCH", "delete": "DELETE", read: "GET" }; e.ajax = function () { return e.$.ajax.apply(e.$, arguments) }; var C = e.Router = function (e) { e || (e = {}), e.routes && (this.routes = e.routes), this._bindRoutes(), this.initialize.apply(this, arguments) }, E = /\((.*?)\)/g, T = /(\(\?)?:\w+/g, k = /\*\w+/g, R = /[\-{}\[\]+?.,\\\^$|#\s]/g; s.extend(C.prototype, o, { initialize: function () { }, route: function (t, n, i) { s.isRegExp(t) || (t = this._routeToRegExp(t)), s.isFunction(n) && (i = n, n = ""), i || (i = this[n]); var r = this; return e.history.route(t, function (s) { var o = r._extractParameters(t, s); i && i.apply(r, o), r.trigger.apply(r, ["route:" + n].concat(o)), r.trigger("route", n, o), e.history.trigger("route", r, n, o) }), this }, navigate: function (t, n) { return e.history.navigate(t, n), this }, _bindRoutes: function () { if (this.routes) { this.routes = s.result(this, "routes"); for (var e, t = s.keys(this.routes) ; null != (e = t.pop()) ;) this.route(e, this.routes[e]) } }, _routeToRegExp: function (e) { return e = e.replace(R, "\\$&").replace(E, "(?:$1)?").replace(T, function (e, t) { return t ? e : "([^/]+)" }).replace(k, "(.*?)"), new RegExp("^" + e + "$") }, _extractParameters: function (e, t) { var n = e.exec(t).slice(1); return s.map(n, function (e) { return e ? decodeURIComponent(e) : null }) } }); var $ = e.History = function () { this.handlers = [], s.bindAll(this, "checkUrl"), "undefined" != typeof window && (this.location = window.location, this.history = window.history) }, N = /^[#\/]|\s+$/g, S = /^\/+|\/+$/g, O = /msie [\w.]+/, A = /\/$/, M = /[?#].*$/; $.started = !1, s.extend($.prototype, o, {
        interval: 50, getHash: function (e) { var t = (e || this).location.href.match(/#(.*)$/); return t ? t[1] : "" }, getFragment: function (e, t) { if (null == e) if (this._hasPushState || !this._wantsHashChange || t) { e = this.location.pathname; var n = this.root.replace(A, ""); e.indexOf(n) || (e = e.slice(n.length)) } else e = this.getHash(); return e.replace(N, "") }, start: function (t) { if ($.started) throw new Error("Backbone.history has already been started"); $.started = !0, this.options = s.extend({ root: "/" }, this.options, t), this.root = this.options.root, this._wantsHashChange = this.options.hashChange !== !1, this._wantsPushState = !!this.options.pushState, this._hasPushState = !!(this.options.pushState && this.history && this.history.pushState); var n = this.getFragment(), i = document.documentMode, r = O.exec(navigator.userAgent.toLowerCase()) && (!i || 7 >= i); this.root = ("/" + this.root + "/").replace(S, "/"), r && this._wantsHashChange && (this.iframe = e.$('<iframe src="javascript:0" tabindex="-1" />').hide().appendTo("body")[0].contentWindow, this.navigate(n)), this._hasPushState ? e.$(window).on("popstate", this.checkUrl) : this._wantsHashChange && "onhashchange" in window && !r ? e.$(window).on("hashchange", this.checkUrl) : this._wantsHashChange && (this._checkUrlInterval = setInterval(this.checkUrl, this.interval)), this.fragment = n; var o = this.location, a = o.pathname.replace(/[^\/]$/, "$&/") === this.root; if (this._wantsHashChange && this._wantsPushState) { if (!this._hasPushState && !a) return this.fragment = this.getFragment(null, !0), this.location.replace(this.root + this.location.search + "#" + this.fragment), !0; this._hasPushState && a && o.hash && (this.fragment = this.getHash().replace(N, ""), this.history.replaceState({}, document.title, this.root + this.fragment + o.search)) } return this.options.silent ? void 0 : this.loadUrl() }, stop: function () { e.$(window).off("popstate", this.checkUrl).off("hashchange", this.checkUrl), clearInterval(this._checkUrlInterval), $.started = !1 }, route: function (e, t) { this.handlers.unshift({ route: e, callback: t }) }, checkUrl: function () { var e = this.getFragment(); return e === this.fragment && this.iframe && (e = this.getFragment(this.getHash(this.iframe))), e === this.fragment ? !1 : (this.iframe && this.navigate(e), void this.loadUrl()) }, loadUrl: function (e) { return e = this.fragment = this.getFragment(e), s.any(this.handlers, function (t) { return t.route.test(e) ? (t.callback(e), !0) : void 0 }) }, navigate: function (e, t) {
            if (!$.started) return !1; t && t !== !0 || (t = { trigger: !!t }); var n = this.root + (e = this.getFragment(e || "")); if (e = e.replace(M, ""), this.fragment !== e) {
                if (this.fragment = e, "" === e && "/" !== n && (n = n.slice(0, -1)), this._hasPushState) this.history[t.replace ? "replaceState" : "pushState"]({}, document.title, n); else {
                    if (!this._wantsHashChange) return this.location.assign(n);
                    this._updateHash(this.location, e, t.replace), this.iframe && e !== this.getFragment(this.getHash(this.iframe)) && (t.replace || this.iframe.document.open().close(), this._updateHash(this.iframe.location, e, t.replace))
                } return t.trigger ? this.loadUrl(e) : void 0
            }
        }, _updateHash: function (e, t, n) { if (n) { var i = e.href.replace(/(javascript:|#).*$/, ""); e.replace(i + "#" + t) } else e.hash = "#" + t }
    }), e.history = new $; var D = function (e, t) { var n, i = this; n = e && s.has(e, "constructor") ? e.constructor : function () { return i.apply(this, arguments) }, s.extend(n, i, t); var r = function () { this.constructor = n }; return r.prototype = i.prototype, n.prototype = new r, e && s.extend(n.prototype, e), n.__super__ = i.prototype, n }; h.extend = f.extend = C.extend = y.extend = $.extend = D; var I = function () { throw new Error('A "url" property or function must be specified') }, j = function (e, t) { var n = t.error; t.error = function (i) { n && n(e, i, t), e.trigger("error", e, i, t) } }
}.call(this), !function (e) { "object" == typeof exports ? module.exports = e(module.exports, require("underscore"), require("backbone")) : e(this, this._, this.Backbone) }(function (e, t, n) { "use strict"; function i(e, t, n) { var i = t - (e + "").length; i = 0 > i ? 0 : i; for (var r = "", s = 0; i > s; s++) r += n; return r + e } var r = "	\n\f\r   ᠎             　\u2028\u2029"; if (!String.prototype.trim || r.trim()) { r = "[" + r + "]"; var s = new RegExp("^" + r + r + "*"), o = new RegExp(r + r + "*$"); String.prototype.trim = function () { if (void 0 === this || null === this) throw new TypeError("can't convert " + this + " to object"); return String(this).replace(s, "").replace(o, "") } } var a = n.$, l = e.Backgrid = { Extension: {}, resolveNameToClass: function (e, n) { if (t.isString(e)) { var i = t.map(e.split("-"), function (e) { return e.slice(0, 1).toUpperCase() + e.slice(1) }).join("") + n, r = l[i] || l.Extension[i]; if (t.isUndefined(r)) throw new ReferenceError("Class '" + i + "' not found"); return r } return e }, callByNeed: function () { var e = arguments[0]; if (!t.isFunction(e)) return e; var n = arguments[1], i = [].slice.call(arguments, 2); return e.apply(n, i + "" ? i : []) } }; t.extend(l, n.Events); var u = l.Command = function (e) { t.extend(this, { altKey: !!e.altKey, "char": e["char"], charCode: e.charCode, ctrlKey: !!e.ctrlKey, key: e.key, keyCode: e.keyCode, locale: e.locale, location: e.location, metaKey: !!e.metaKey, repeat: !!e.repeat, shiftKey: !!e.shiftKey, which: e.which }) }; t.extend(u.prototype, { moveUp: function () { return 38 == this.keyCode }, moveDown: function () { return 40 === this.keyCode }, moveLeft: function () { return this.shiftKey && 9 === this.keyCode }, moveRight: function () { return !this.shiftKey && 9 === this.keyCode }, save: function () { return 13 === this.keyCode }, cancel: function () { return 27 === this.keyCode }, passThru: function () { return !(this.moveUp() || this.moveDown() || this.moveLeft() || this.moveRight() || this.save() || this.cancel()) } }); var c = l.CellFormatter = function () { }; t.extend(c.prototype, { fromRaw: function (e) { return e }, toRaw: function (e) { return e } }); var h = l.NumberFormatter = function (e) { if (t.extend(this, this.defaults, e || {}), this.decimals < 0 || this.decimals > 20) throw new RangeError("decimals must be between 0 and 20") }; h.prototype = new c, t.extend(h.prototype, { defaults: { decimals: 2, decimalSeparator: ".", orderSeparator: "," }, HUMANIZED_NUM_RE: /(\d)(?=(?:\d{3})+$)/g, fromRaw: function (e) { if (t.isNull(e) || t.isUndefined(e)) return ""; e = e.toFixed(~~this.decimals); var n = e.split("."), i = n[0], r = n[1] ? (this.decimalSeparator || ".") + n[1] : ""; return i.replace(this.HUMANIZED_NUM_RE, "$1" + this.orderSeparator) + r }, toRaw: function (e) { if (e = e.trim(), "" === e) return null; for (var n = "", i = e.split(this.orderSeparator), r = 0; r < i.length; r++) n += i[r]; var s = n.split(this.decimalSeparator); n = ""; for (var r = 0; r < s.length; r++) n = n + s[r] + "."; "." === n[n.length - 1] && (n = n.slice(0, n.length - 1)); var o = 1 * (1 * n).toFixed(~~this.decimals); return t.isNumber(o) && !t.isNaN(o) ? o : void 0 } }); var d = l.PercentFormatter = function () { l.NumberFormatter.apply(this, arguments) }; d.prototype = new l.NumberFormatter, t.extend(d.prototype, { defaults: t.extend({}, h.prototype.defaults, { multiplier: 1, symbol: "%" }), fromRaw: function (e) { var t = [].slice.call(arguments, 1); return t.unshift(e * this.multiplier), (h.prototype.fromRaw.apply(this, t) || "0") + this.symbol }, toRaw: function (e) { var n = e.split(this.symbol); if (n && n[0] && "" === n[1] || null == n[1]) { var i = h.prototype.toRaw.call(this, n[0]); return t.isUndefined(i) ? i : i / this.multiplier } } }); var f = l.DatetimeFormatter = function (e) { if (t.extend(this, this.defaults, e || {}), !this.includeDate && !this.includeTime) throw new Error("Either includeDate or includeTime must be true") }; f.prototype = new c, t.extend(f.prototype, { defaults: { includeDate: !0, includeTime: !0, includeMilli: !1 }, DATE_RE: /^([+\-]?\d{4})-(\d{2})-(\d{2})$/, TIME_RE: /^(\d{2}):(\d{2}):(\d{2})(\.(\d{3}))?$/, ISO_SPLITTER_RE: /T|Z| +/, _convert: function (e, n) { if ("" === (e + "").trim()) return null; var r, s = null; if (t.isNumber(e)) { var o = new Date(e); r = i(o.getUTCFullYear(), 4, 0) + "-" + i(o.getUTCMonth() + 1, 2, 0) + "-" + i(o.getUTCDate(), 2, 0), s = i(o.getUTCHours(), 2, 0) + ":" + i(o.getUTCMinutes(), 2, 0) + ":" + i(o.getUTCSeconds(), 2, 0) } else { e = e.trim(); var a = e.split(this.ISO_SPLITTER_RE) || []; r = this.DATE_RE.test(a[0]) ? a[0] : "", s = r && a[1] ? a[1] : this.TIME_RE.test(a[0]) ? a[0] : "" } var l = this.DATE_RE.exec(r) || [], u = this.TIME_RE.exec(s) || []; if (n) { if (this.includeDate && t.isUndefined(l[0])) return; if (this.includeTime && t.isUndefined(u[0])) return; if (!this.includeDate && r) return; if (!this.includeTime && s) return } var o = new Date(Date.UTC(1 * l[1] || 0, 1 * l[2] - 1 || 0, 1 * l[3] || 0, 1 * u[1] || null, 1 * u[2] || null, 1 * u[3] || null, 1 * u[5] || null)), c = ""; return this.includeDate && (c = i(o.getUTCFullYear(), 4, 0) + "-" + i(o.getUTCMonth() + 1, 2, 0) + "-" + i(o.getUTCDate(), 2, 0)), this.includeTime && (c = c + (this.includeDate ? "T" : "") + i(o.getUTCHours(), 2, 0) + ":" + i(o.getUTCMinutes(), 2, 0) + ":" + i(o.getUTCSeconds(), 2, 0), this.includeMilli && (c = c + "." + i(o.getUTCMilliseconds(), 3, 0))), this.includeDate && this.includeTime && (c += "Z"), c }, fromRaw: function (e) { return t.isNull(e) || t.isUndefined(e) ? "" : this._convert(e) }, toRaw: function (e) { return this._convert(e, !0) } }); var p = l.StringFormatter = function () { }; p.prototype = new c, t.extend(p.prototype, { fromRaw: function (e) { return t.isUndefined(e) || t.isNull(e) ? "" : e + "" } }); var m = l.EmailFormatter = function () { }; m.prototype = new c, t.extend(m.prototype, { toRaw: function (e) { var n = e.trim().split("@"); return 2 === n.length && t.all(n) ? e : void 0 } }); var g = l.SelectFormatter = function () { }; g.prototype = new c, t.extend(g.prototype, { fromRaw: function (e) { return t.isArray(e) ? e : null != e ? [e] : [] } }); var v = l.CellEditor = n.View.extend({ initialize: function (e) { this.formatter = e.formatter, this.column = e.column, this.column instanceof $ || (this.column = new $(this.column)), this.listenTo(this.model, "backgrid:editing", this.postRender) }, postRender: function (e, t) { return (null == t || t.get("name") == this.column.get("name")) && this.$el.focus(), this } }), y = l.InputCellEditor = v.extend({ tagName: "input", attributes: { type: "text" }, events: { blur: "saveOrCancel", keydown: "saveOrCancel" }, initialize: function (e) { y.__super__.initialize.apply(this, arguments), e.placeholder && this.$el.attr("placeholder", e.placeholder) }, render: function () { var e = this.model; return this.$el.val(this.formatter.fromRaw(e.get(this.column.get("name")), e)), this }, saveOrCancel: function (e) { var n = this.formatter, i = this.model, r = this.column, s = new u(e), o = "blur" === e.type; if (s.moveUp() || s.moveDown() || s.moveLeft() || s.moveRight() || s.save() || o) { e.preventDefault(), e.stopPropagation(); var a = this.$el.val(), l = n.toRaw(a, i); t.isUndefined(l) ? i.trigger("backgrid:error", i, r, a) : (i.set(r.get("name"), l), i.trigger("backgrid:edited", i, r, s)) } else s.cancel() && (e.stopPropagation(), i.trigger("backgrid:edited", i, r, s)) }, postRender: function (e, t) { if (null == t || t.get("name") == this.column.get("name")) if ("right" === this.$el.css("text-align")) { var n = this.$el.val(); this.$el.focus().val(null).val(n) } else this.$el.focus(); return this } }), b = l.Cell = n.View.extend({ tagName: "td", formatter: c, editor: y, events: { click: "enterEditMode" }, initialize: function (e) { this.column = e.column, this.column instanceof $ || (this.column = new $(this.column)); var n = this.column, i = this.model, r = this.$el, s = l.resolveNameToClass(n.get("formatter") || this.formatter, "Formatter"); t.isFunction(s.fromRaw) || t.isFunction(s.toRaw) || (s = new s), this.formatter = s, this.editor = l.resolveNameToClass(this.editor, "CellEditor"), this.listenTo(i, "change:" + n.get("name"), function () { r.hasClass("editor") || this.render() }), this.listenTo(i, "backgrid:error", this.renderError), this.listenTo(n, "change:editable change:sortable change:renderable", function (e) { var t = e.changedAttributes(); for (var n in t) t.hasOwnProperty(n) && r.toggleClass(n, t[n]) }), l.callByNeed(n.editable(), n, i) && r.addClass("editable"), l.callByNeed(n.sortable(), n, i) && r.addClass("sortable"), l.callByNeed(n.renderable(), n, i) && r.addClass("renderable") }, render: function () { this.$el.empty(); var e = this.model; return this.$el.text(this.formatter.fromRaw(e.get(this.column.get("name")), e)), this.delegateEvents(), this }, enterEditMode: function () { var e = this.model, t = this.column, n = l.callByNeed(t.editable(), t, e); n && (this.currentEditor = new this.editor({ column: this.column, model: this.model, formatter: this.formatter }), e.trigger("backgrid:edit", e, t, this, this.currentEditor), this.undelegateEvents(), this.$el.empty(), this.$el.append(this.currentEditor.$el), this.currentEditor.render(), this.$el.addClass("editor"), e.trigger("backgrid:editing", e, t, this, this.currentEditor)) }, renderError: function (e, t) { (null == t || t.get("name") == this.column.get("name")) && this.$el.addClass("error") }, exitEditMode: function () { this.$el.removeClass("error"), this.currentEditor.remove(), this.stopListening(this.currentEditor), delete this.currentEditor, this.$el.removeClass("editor"), this.render() }, remove: function () { return this.currentEditor && (this.currentEditor.remove.apply(this.currentEditor, arguments), delete this.currentEditor), b.__super__.remove.apply(this, arguments) } }), w = l.StringCell = b.extend({ className: "string-cell", formatter: p }), x = l.UriCell = b.extend({ className: "uri-cell", title: null, target: "_blank", initialize: function (e) { x.__super__.initialize.apply(this, arguments), this.title = e.title || this.title, this.target = e.target || this.target }, render: function () { this.$el.empty(); var e = this.model.get(this.column.get("name")), t = this.formatter.fromRaw(e, this.model); return this.$el.append(a("<a>", { tabIndex: -1, href: e, title: this.title || t, target: this.target }).text(t)), this.delegateEvents(), this } }), _ = (l.EmailCell = w.extend({ className: "email-cell", formatter: m, render: function () { this.$el.empty(); var e = this.model, t = this.formatter.fromRaw(e.get(this.column.get("name")), e); return this.$el.append(a("<a>", { tabIndex: -1, href: "mailto:" + t, title: t }).text(t)), this.delegateEvents(), this } }), l.NumberCell = b.extend({ className: "number-cell", decimals: h.prototype.defaults.decimals, decimalSeparator: h.prototype.defaults.decimalSeparator, orderSeparator: h.prototype.defaults.orderSeparator, formatter: h, initialize: function () { _.__super__.initialize.apply(this, arguments); var e = this.formatter; e.decimals = this.decimals, e.decimalSeparator = this.decimalSeparator, e.orderSeparator = this.orderSeparator } })), C = (l.IntegerCell = _.extend({ className: "integer-cell", decimals: 0 }), l.PercentCell = _.extend({ className: "percent-cell", multiplier: d.prototype.defaults.multiplier, symbol: d.prototype.defaults.symbol, formatter: d, initialize: function () { C.__super__.initialize.apply(this, arguments); var e = this.formatter; e.multiplier = this.multiplier, e.symbol = this.symbol } })), E = l.DatetimeCell = b.extend({ className: "datetime-cell", includeDate: f.prototype.defaults.includeDate, includeTime: f.prototype.defaults.includeTime, includeMilli: f.prototype.defaults.includeMilli, formatter: f, initialize: function () { E.__super__.initialize.apply(this, arguments); var e = this.formatter; e.includeDate = this.includeDate, e.includeTime = this.includeTime, e.includeMilli = this.includeMilli; var n = this.includeDate ? "YYYY-MM-DD" : ""; n += this.includeDate && this.includeTime ? "T" : "", n += this.includeTime ? "HH:mm:ss" : "", n += this.includeTime && this.includeMilli ? ".SSS" : "", this.editor = this.editor.extend({ attributes: t.extend({}, this.editor.prototype.attributes, this.editor.attributes, { placeholder: n }) }) } }), T = (l.DateCell = E.extend({ className: "date-cell", includeTime: !1 }), l.TimeCell = E.extend({ className: "time-cell", includeDate: !1 }), l.BooleanCellEditor = v.extend({ tagName: "input", attributes: { tabIndex: -1, type: "checkbox" }, events: { mousedown: function () { this.mouseDown = !0 }, blur: "enterOrExitEditMode", mouseup: function () { this.mouseDown = !1 }, change: "saveOrCancel", keydown: "saveOrCancel" }, render: function () { var e = this.model, t = this.formatter.fromRaw(e.get(this.column.get("name")), e); return this.$el.prop("checked", t), this }, enterOrExitEditMode: function (e) { if (!this.mouseDown) { var t = this.model; t.trigger("backgrid:edited", t, this.column, new u(e)) } }, saveOrCancel: function (e) { var t = this.model, n = this.column, i = this.formatter, r = new u(e); if (r.passThru() && "change" != e.type) return !0; r.cancel() && (e.stopPropagation(), t.trigger("backgrid:edited", t, n, r)); var s = this.$el; if (r.save() || r.moveLeft() || r.moveRight() || r.moveUp() || r.moveDown()) { e.preventDefault(), e.stopPropagation(); var o = i.toRaw(s.prop("checked"), t); t.set(n.get("name"), o), t.trigger("backgrid:edited", t, n, r) } else if ("change" == e.type) { var o = i.toRaw(s.prop("checked"), t); t.set(n.get("name"), o), s.focus() } } })), k = (l.BooleanCell = b.extend({ className: "boolean-cell", editor: T, events: { click: "enterEditMode" }, render: function () { this.$el.empty(); var e = this.model, t = this.column, n = l.callByNeed(t.editable(), t, e); return this.$el.append(a("<input>", { tabIndex: -1, type: "checkbox", checked: this.formatter.fromRaw(e.get(t.get("name")), e), disabled: !n })), this.delegateEvents(), this } }), l.SelectCellEditor = v.extend({ tagName: "select", events: { change: "save", blur: "close", keydown: "close" }, template: t.template('<option value="<%- value %>" <%= selected ? \'selected="selected"\' : "" %>><%- text %></option>', null, { variable: null }), setOptionValues: function (e) { this.optionValues = e, this.optionValues = t.result(this, "optionValues") }, setMultiple: function (e) { this.multiple = e, this.$el.prop("multiple", e) }, _renderOptions: function (e, n) { for (var i = "", r = 0; r < e.length; r++) i += this.template({ text: e[r][0], value: e[r][1], selected: t.indexOf(n, e[r][1]) > -1 }); return i }, render: function () { this.$el.empty(); var e = t.result(this, "optionValues"), n = this.model, i = this.formatter.fromRaw(n.get(this.column.get("name")), n); if (!t.isArray(e)) throw new TypeError("optionValues must be an array"); for (var r = null, s = null, r = null, o = null, l = null, u = 0; u < e.length; u++) { var r = e[u]; if (t.isArray(r)) s = r[0], r = r[1], this.$el.append(this.template({ text: s, value: r, selected: t.indexOf(i, r) > -1 })); else { if (!t.isObject(r)) throw new TypeError("optionValues elements must be a name-value pair or an object hash of { name: 'optgroup label', value: [option name-value pairs] }"); o = r.name, l = a("<optgroup></optgroup>", { label: o }), l.append(this._renderOptions.call(this, r.values, i)), this.$el.append(l) } } return this.delegateEvents(), this }, save: function () { var e = this.model, t = this.column; e.set(t.get("name"), this.formatter.toRaw(this.$el.val(), e)) }, close: function (e) { var t = this.model, n = this.column, i = new u(e); i.cancel() ? (e.stopPropagation(), t.trigger("backgrid:edited", t, n, new u(e))) : (i.save() || i.moveLeft() || i.moveRight() || i.moveUp() || i.moveDown() || "blur" == e.type) && (e.preventDefault(), e.stopPropagation(), this.save(e), t.trigger("backgrid:edited", t, n, new u(e))) } })), R = l.SelectCell = b.extend({ className: "select-cell", editor: k, multiple: !1, formatter: g, optionValues: void 0, delimiter: ", ", initialize: function () { R.__super__.initialize.apply(this, arguments), this.listenTo(this.model, "backgrid:edit", function (e, t, n, i) { t.get("name") == this.column.get("name") && (i.setOptionValues(this.optionValues), i.setMultiple(this.multiple)) }) }, render: function () { this.$el.empty(); var e = t.result(this, "optionValues"), n = this.model, i = this.formatter.fromRaw(n.get(this.column.get("name")), n), r = []; try { if (!t.isArray(e) || t.isEmpty(e)) throw new TypeError; for (var s = 0; s < i.length; s++) for (var o = i[s], a = 0; a < e.length; a++) { var l = e[a]; if (t.isArray(l)) { var u = l[0], l = l[1]; l == o && r.push(u) } else { if (!t.isObject(l)) throw new TypeError; for (var c = l.values, h = 0; h < c.length; h++) { var d = c[h]; d[1] == o && r.push(d[0]) } } } this.$el.append(r.join(this.delimiter)) } catch (f) { if (f instanceof TypeError) throw new TypeError("'optionValues' must be of type {Array.<Array>|Array.<{name: string, values: Array.<Array>}>}"); throw f } return this.delegateEvents(), this } }), $ = l.Column = n.Model.extend({ defaults: { name: void 0, label: void 0, sortable: !0, editable: !0, renderable: !0, formatter: void 0, sortType: "cycle", sortValue: void 0, direction: null, cell: void 0, headerCell: void 0 }, initialize: function () { this.has("label") || this.set({ label: this.get("name") }, { silent: !0 }); var e = l.resolveNameToClass(this.get("headerCell"), "HeaderCell"), t = l.resolveNameToClass(this.get("cell"), "Cell"); this.set({ cell: t, headerCell: e }, { silent: !0 }) }, sortValue: function () { var e = this.get("sortValue"); return t.isString(e) ? this[e] : t.isFunction(e) ? e : function (e, t) { return isNaN(e.get(t)) ? e.get(t).replace("Ç", "C").replace("İ", "I").replace("Ş", "S") : e.get(t) } } }); t.each(["sortable", "renderable", "editable"], function (e) { $.prototype[e] = function () { var n = this.get(e); return t.isString(n) ? this[n] : t.isFunction(n) ? n : !!n } }); var N = l.Columns = n.Collection.extend({ model: $ }), S = l.Row = n.View.extend({ tagName: "tr", initialize: function (e) { var t = this.columns = e.columns; t instanceof n.Collection || (t = this.columns = new N(t)); for (var i = this.cells = [], r = 0; r < t.length; r++) i.push(this.makeCell(t.at(r), e)); this.listenTo(t, "add", function (t, n) { var r = n.indexOf(t), s = this.makeCell(t, e); i.splice(r, 0, s); var o = this.$el; 0 === r ? o.prepend(s.render().$el) : r === n.length - 1 ? o.append(s.render().$el) : o.children().eq(r).before(s.render().$el) }), this.listenTo(t, "remove", function (e, t, n) { i[n.index].remove(), i.splice(n.index, 1) }) }, makeCell: function (e) { return new (e.get("cell"))({ column: e, model: this.model }) }, render: function () { this.$el.empty(); for (var e = document.createDocumentFragment(), t = 0; t < this.cells.length; t++) e.appendChild(this.cells[t].render().el); return this.el.appendChild(e), this.delegateEvents(), this }, remove: function () { for (var e = 0; e < this.cells.length; e++) { var t = this.cells[e]; t.remove.apply(t, arguments) } return n.View.prototype.remove.apply(this, arguments) } }), O = l.EmptyRow = n.View.extend({ tagName: "tr", emptyText: null, initialize: function (e) { this.emptyText = e.emptyText, this.columns = e.columns }, render: function () { this.$el.empty(); var e = document.createElement("td"); return e.setAttribute("colspan", this.columns.length), e.appendChild(document.createTextNode(t.result(this, "emptyText"))), this.el.className = "empty", this.el.appendChild(e), this } }), A = l.HeaderCell = n.View.extend({ tagName: "th", events: { "click a": "onClick" }, initialize: function (e) { this.column = e.column, this.column instanceof $ || (this.column = new $(this.column)); var t = this.column, n = this.collection, i = this.$el; this.listenTo(t, "change:editable change:sortable change:renderable", function (e) { var t = e.changedAttributes(); for (var n in t) t.hasOwnProperty(n) && i.toggleClass(n, t[n]) }), this.listenTo(t, "change:direction", this.setCellDirection), this.listenTo(t, "change:name change:label", this.render), l.callByNeed(t.editable(), t, n) && i.addClass("editable"), l.callByNeed(t.sortable(), t, n) && i.addClass("sortable"), l.callByNeed(t.renderable(), t, n) && i.addClass("renderable"), this.listenTo(n.fullCollection || n, "sort", this.removeCellDirection) }, removeCellDirection: function () { this.$el.removeClass("ascending").removeClass("descending"), this.column.set("direction", null) }, setCellDirection: function (e, t) { this.$el.removeClass("ascending").removeClass("descending"), e.cid == this.column.cid && this.$el.addClass(t) }, onClick: function (e) { function t(e, t) { "ascending" === i.get("direction") ? r.trigger(s, t, "descending") : "descending" === i.get("direction") ? r.trigger(s, t, null) : r.trigger(s, t, "ascending") } function n(e, t) { "ascending" === i.get("direction") ? r.trigger(s, t, "descending") : r.trigger(s, t, "ascending") } e.preventDefault(); var i = this.column, r = this.collection, s = "backgrid:sort", o = l.callByNeed(i.sortable(), i, this.collection); if (o) { var a = i.get("sortType"); "toggle" === a ? n(this, i) : t(this, i) } }, render: function () { this.$el.empty(); var e, t = this.column, n = l.callByNeed(t.sortable(), t, this.collection); return e = n ? a("<a>").text(t.get("label")) : document.createTextNode(t.get("label")), this.$el.append(e), this.$el.addClass(t.get("name")), this.$el.addClass(t.get("direction")), this.delegateEvents(), this } }), M = (l.HeaderRow = l.Row.extend({ requiredOptions: ["columns", "collection"], initialize: function () { l.Row.prototype.initialize.apply(this, arguments) }, makeCell: function (e, t) { var n = e.get("headerCell") || t.headerCell || A; return n = new n({ column: e, collection: this.collection }) } }), l.Header = n.View.extend({ tagName: "thead", initialize: function (e) { this.columns = e.columns, this.columns instanceof n.Collection || (this.columns = new N(this.columns)), this.row = new l.HeaderRow({ columns: this.columns, collection: this.collection }) }, render: function () { return this.$el.append(this.row.render().$el), this.delegateEvents(), this }, remove: function () { return this.row.remove.apply(this.row, arguments), n.View.prototype.remove.apply(this, arguments) } })), D = l.Body = n.View.extend({ tagName: "tbody", initialize: function (e) { this.columns = e.columns, this.columns instanceof n.Collection || (this.columns = new N(this.columns)), this.row = e.row || S, this.rows = this.collection.map(function (e) { var t = new this.row({ columns: this.columns, model: e }); return t }, this), this.emptyText = e.emptyText, this._unshiftEmptyRowMayBe(); var t = this.collection; this.listenTo(t, "add", this.insertRow), this.listenTo(t, "remove", this.removeRow), this.listenTo(t, "sort", this.refresh), this.listenTo(t, "reset", this.refresh), this.listenTo(t, "backgrid:sort", this.sort), this.listenTo(t, "backgrid:edited", this.moveToNextCell) }, _unshiftEmptyRowMayBe: function () { 0 === this.rows.length && null != this.emptyText && this.rows.unshift(new O({ emptyText: this.emptyText, columns: this.columns })) }, insertRow: function (e, t, i) { if (this.rows[0] instanceof O && this.rows.pop().remove(), !(t instanceof n.Collection || i)) return void this.collection.add(e, i = t); var r = new this.row({ columns: this.columns, model: e }), s = t.indexOf(e); this.rows.splice(s, 0, r); var o = this.$el, a = o.children(), l = r.render().$el; return s >= a.length ? o.append(l) : a.eq(s).before(l), this }, removeRow: function (e, n, i) { return i ? ((t.isUndefined(i.render) || i.render) && this.rows[i.index].remove(), this.rows.splice(i.index, 1), this._unshiftEmptyRowMayBe(), this) : (this.collection.remove(e, i = n), void this._unshiftEmptyRowMayBe()) }, refresh: function () { for (var e = 0; e < this.rows.length; e++) this.rows[e].remove(); return this.rows = this.collection.map(function (e) { var t = new this.row({ columns: this.columns, model: e }); return t }, this), this._unshiftEmptyRowMayBe(), this.render(), this.collection.trigger("backgrid:refresh", this), this }, render: function () { this.$el.empty(); for (var e = document.createDocumentFragment(), t = 0; t < this.rows.length; t++) { var n = this.rows[t]; e.appendChild(n.render().el) } return this.el.appendChild(e), this.delegateEvents(), this }, remove: function () { for (var e = 0; e < this.rows.length; e++) { var t = this.rows[e]; t.remove.apply(t, arguments) } return n.View.prototype.remove.apply(this, arguments) }, sort: function (e, i) { if (!t.contains(["ascending", "descending", null], i)) throw new RangeError('direction must be one of "ascending", "descending" or `null`'); t.isString(e) && (e = this.columns.findWhere({ name: e })); var r, s = this.collection; r = "ascending" === i ? -1 : "descending" === i ? 1 : null; var o = this.makeComparator(e.get("name"), r, r ? e.sortValue() : function (e) { return 1 * e.cid.replace("c", "") }); return n.PageableCollection && s instanceof n.PageableCollection ? (s.setSorting(r && e.get("name"), r, { sortValue: e.sortValue() }), s.fullCollection ? (null == s.fullCollection.comparator && (s.fullCollection.comparator = o), s.fullCollection.sort(), s.trigger("backgrid:sorted", e, i, s)) : s.fetch({ reset: !0, success: function () { s.trigger("backgrid:sorted", e, i, s) } })) : (s.comparator = o, s.sort(), s.trigger("backgrid:sorted", e, i, s)), e.set("direction", i), this }, makeComparator: function (e, t, n) { return function (i, r) { var s, o = n(i, e), a = n(r, e); return 1 === t && (s = o, o = a, a = s), o === a ? 0 : a > o ? -1 : 1 } }, moveToNextCell: function (e, t, n) { var i, r, s, o, a, u = this.collection.indexOf(e), c = this.columns.indexOf(t); if (this.rows[u].cells[c].exitEditMode(), n.moveUp() || n.moveDown() || n.moveLeft() || n.moveRight() || n.save()) { var h = this.columns.length, d = h * this.collection.length; if (n.moveUp() || n.moveDown()) { o = u + (n.moveUp() ? -1 : 1); var f = this.rows[o]; f ? (i = f.cells[c], l.callByNeed(i.column.editable(), i.column, e) && (i.enterEditMode(), e.trigger("backgrid:next", o, c, !1))) : e.trigger("backgrid:next", o, c, !0) } else if (n.moveLeft() || n.moveRight()) { for (var p = n.moveRight(), m = u * h + c + (p ? 1 : -1) ; m >= 0 && d > m; p ? m++ : m--) if (o = ~~(m / h), a = m - o * h, i = this.rows[o].cells[a], r = l.callByNeed(i.column.renderable(), i.column, i.model), s = l.callByNeed(i.column.editable(), i.column, e), r && s) { i.enterEditMode(), e.trigger("backgrid:next", o, a, !1); break } m == d && e.trigger("backgrid:next", ~~(m / h), m - o * h, !0) } } return this } }); return l.Footer = n.View.extend({ tagName: "tfoot", initialize: function (e) { this.columns = e.columns, this.columns instanceof n.Collection || (this.columns = new l.Columns(this.columns)) } }), l.Grid = n.View.extend({ tagName: "table", className: "backgrid", header: M, body: D, footer: null, initialize: function (e) { e.columns instanceof n.Collection || (e.columns = new N(e.columns)), this.columns = e.columns; var i = t.omit(e, ["el", "id", "attributes", "className", "tagName", "events"]); this.body = e.body || this.body, this.body = new this.body(i), this.header = e.header || this.header, this.header && (this.header = new this.header(i)), this.footer = e.footer || this.footer, this.footer && (this.footer = new this.footer(i)), this.listenTo(this.columns, "reset", function () { this.header && (this.header = new (this.header.remove().constructor)(i)), this.body = new (this.body.remove().constructor)(i), this.footer && (this.footer = new (this.footer.remove().constructor)(i)), this.render() }) }, insertRow: function () { return this.body.insertRow.apply(this.body, arguments), this }, removeRow: function () { return this.body.removeRow.apply(this.body, arguments), this }, insertColumn: function () { return this.columns.add.apply(this.columns, arguments), this }, removeColumn: function () { return this.columns.remove.apply(this.columns, arguments), this }, sort: function () { return this.body.sort.apply(this.body, arguments), this }, render: function () { return this.$el.empty(), this.header && this.$el.append(this.header.render().$el), this.footer && this.$el.append(this.footer.render().$el), this.$el.append(this.body.render().$el), this.delegateEvents(), this.trigger("backgrid:rendered", this), this }, remove: function () { return this.header && this.header.remove.apply(this.header, arguments), this.body.remove.apply(this.body, arguments), this.footer && this.footer.remove.apply(this.footer, arguments), n.View.prototype.remove.apply(this, arguments) } }), l }), !function (e, t) { "object" == typeof exports ? !function () { var e; try { e = require("lunr") } catch (n) { } module.exports = t(require("underscore"), require("backbone"), require("backgrid"), e) }() : t(e._, e.Backbone, e.Backgrid, e.lunr) }(this, function (e, t, n, i) { "use strict"; var r = n.Extension.ServerSideFilter = t.View.extend({ tagName: "form", className: "backgrid-filter form-search", template: function (e) { return '<span class="search">&nbsp;</span><input type="search" ' + (e.placeholder ? 'placeholder="' + e.placeholder + '"' : "") + ' name="' + e.name + '" ' + (e.value ? 'value="' + e.value + '"' : "") + '/><a class="clear" data-backgrid-action="clear" href="#">&times;</a>' }, events: { "keyup input[type=search]": "showClearButtonMaybe", "click a[data-backgrid-action=clear]": "clear", submit: "search" }, name: "q", value: null, placeholder: null, initialize: function (e) { r.__super__.initialize.apply(this, arguments), this.name = e.name || this.name, this.value = e.value || this.value, this.placeholder = e.placeholder || this.placeholder, this.template = e.template || this.template; var n = this.collection, i = this; t.PageableCollection && n instanceof t.PageableCollection && "server" == n.mode && (n.queryParams[this.name] = function () { return i.searchBox().val() || null }) }, clearSearchBox: function () { this.value = null, this.searchBox().val(null), this.showClearButtonMaybe() }, showClearButtonMaybe: function () { var e = this.clearButton(), t = this.searchBox().val(); t ? e.show() : e.hide() }, searchBox: function () { return this.$el.find("input[type=search]") }, clearButton: function () { return this.$el.find("a[data-backgrid-action=clear]") }, query: function () { return this.value = this.searchBox().val(), this.value }, search: function (e) { e && e.preventDefault(); var n = {}, i = this.query(); i && (n[this.name] = i); var r = this.collection; t.PageableCollection && r instanceof t.PageableCollection ? r.getFirstPage({ data: n, reset: !0, fetch: !0 }) : r.fetch({ data: n, reset: !0 }) }, clear: function (e) { e && e.preventDefault(), this.clearSearchBox(); var n = this.collection; t.PageableCollection && n instanceof t.PageableCollection ? n.getFirstPage({ reset: !0, fetch: !0 }) : n.fetch({ reset: !0 }) }, render: function () { return this.$el.empty().append(this.template({ name: this.name, placeholder: this.placeholder, value: this.value })), this.showClearButtonMaybe(), this.delegateEvents(), this } }), s = n.Extension.ClientSideFilter = r.extend({ events: e.extend({}, r.prototype.events, { "click a[data-backgrid-action=clear]": function (e) { e.preventDefault(), this.clear() }, "keydown input[type=search]": "search", submit: function (e) { e.preventDefault(), this.search() } }), fields: null, wait: 149, initialize: function (t) { s.__super__.initialize.apply(this, arguments), this.fields = t.fields || this.fields, this.wait = t.wait || this.wait, this._debounceMethods(["search", "clear"]); var n = this.collection = this.collection.fullCollection || this.collection, i = this.shadowCollection = n.clone(); this.listenTo(n, "add", function (e, t, n) { i.add(e, n) }), this.listenTo(n, "remove", function (e, t, n) { i.remove(e, n) }), this.listenTo(n, "sort", function (e) { this.searchBox().val() || i.reset(e.models) }), this.listenTo(n, "reset", function (t, n) { n = e.extend({ reindex: !0 }, n || {}), n.reindex && null == n.from && null == n.to && i.reset(t.models) }) }, _debounceMethods: function (t) { e.isString(t) && (t = [t]), this.undelegateEvents(); for (var n = 0, i = t.length; i > n; n++) { var r = t[n], s = this[r]; this[r] = e.debounce(s, this.wait) } this.delegateEvents() }, makeRegExp: function (e) { return new RegExp(e.replace("i", "İ").trim().split(/\s+/).join("|"), "i") }, makeMatcher: function (e) { var t = this.makeRegExp(e); return function (e) { for (var n = this.fields || e.keys(), i = 0, r = n.length; r > i; i++) if (t.test(e.get(n[i]) + "")) return !0; return !1 } }, search: function () { ArananKelime = $("[type='search']").val(); var t = e.bind(this.makeMatcher(this.query()), this), n = this.collection; $("[type='search']").val().indexOf("^") > -1 && $("[type='search']").val(""), n.pageableCollection && n.pageableCollection.getFirstPage({ silent: !0 }), n.reset(this.shadowCollection.filter(t), { reindex: !1 }) }, clear: function () { this.clearSearchBox(); var e = this.collection; e.pageableCollection && e.pageableCollection.getFirstPage({ silent: !0 }), e.reset(this.shadowCollection.models, { reindex: !1 }) } }), o = n.Extension.LunrFilter = s.extend({ ref: "id", fields: null, initialize: function (e) { o.__super__.initialize.apply(this, arguments), this.ref = e.ref || this.ref; var t = this.collection = this.collection.fullCollection || this.collection; this.listenTo(t, "add", this.addToIndex), this.listenTo(t, "remove", this.removeFromIndex), this.listenTo(t, "reset", this.resetIndex), this.listenTo(t, "change", this.updateIndex), this.resetIndex(t) }, resetIndex: function (t, n) { if (n = e.extend({ reindex: !0 }, n || {}), n.reindex) { var r = this; this.index = i(function () { e.each(r.fields, function (e, t) { this.field(t, e), this.ref(r.ref) }, this) }), t.each(function (e) { this.addToIndex(e) }, this) } }, addToIndex: function (e) { var t = this.index, n = e.toJSON(); t.documentStore.has(n[this.ref]) ? t.update(n) : t.add(n) }, removeFromIndex: function (e) { var t = this.index, n = e.toJSON(); t.documentStore.has(n[this.ref]) && t.remove(n) }, updateIndex: function (t) { var n = t.changedAttributes(); n && !e.isEmpty(e.intersection(e.keys(this.fields), e.keys(n))) && this.index.update(t.toJSON()) }, search: function () { var e = this.collection; if (!this.query()) return void e.reset(this.shadowCollection.models, { reindex: !1 }); for (var t = this.index.search(this.query()), n = [], i = 0; i < t.length; i++) { var r = t[i]; n.push(this.shadowCollection.get(r.ref)) } e.pageableCollection && e.pageableCollection.getFirstPage({ silent: !0 }), e.reset(n, { reindex: !1 }) } }) });